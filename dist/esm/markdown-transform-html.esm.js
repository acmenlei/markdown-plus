function t(t,e,i,n){return new(i||(i=Promise))((function(s,r){function l(t){try{o(n.next(t))}catch(t){r(t)}}function c(t){try{o(n.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(l,c)}o((n=n.apply(t,e||[])).next())}))}class e{constructor(){this.svgMap={},this.isLoading=!1,this.isInitialized=!1,this.loader=null,this.initPromise=null,this.hasLoaderSet=!1}static getInstance(){return e.instance||(e.instance=new e),e.instance}setLoader(t){this.loader=t,this.hasLoaderSet=!0}setSvgMap(t){this.svgMap=t,this.isInitialized=!0,this.hasLoaderSet=!0}initialize(){return t(this,void 0,void 0,(function*(){return this.isLoading&&this.initPromise?this.initPromise:this.loader?(this.isLoading=!0,this.isInitialized=!1,this.initPromise=this.loader().then((t=>(this.svgMap=t,this.isInitialized=!0,this.isLoading=!1,this.svgMap))).catch((t=>(this.isLoading=!1,console.warn("SVG加载失败:",t),this.svgMap))),this.initPromise):(this.isInitialized=!0,this.svgMap)}))}getSvg(t){return this.svgMap[t]||null}isReady(){return this.isInitialized}reset(){this.svgMap={},this.isLoading=!1,this.isInitialized=!1,this.initPromise=null,this.hasLoaderSet=!1}}const i=e.getInstance();function n(t,e=!1){let n=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("**"));){e+=t.slice(0,i);let n=(t=t.slice(i+2)).indexOf("**");if(-1==n){t="**"+t;break}e+=`<strong>${t.slice(0,n)}</strong>`,t=t.slice(n+2)}return t&&(e+=t),e}(t);return n=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("*"));){e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("*");if(-1==n){t="*"+t;break}e+=`<i>${t.slice(0,n)}</i>`,t=t.slice(n+1)}return t&&(e+=t),e}(n),n=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("`"));){e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("`");if(-1==n){t="`"+t;break}e+=`<code class=single-code>${t.slice(0,n)}</code>`,t=t.slice(n+1)}return t&&(e+=t),e}(n),n=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("~~"));){e+=t.slice(0,i);let n=(t=t.slice(i+2)).indexOf("~~");if(-1==n){t="~~"+t;break}e+=`<del>${t.slice(0,n)}</del>`,t=t.slice(n+2)}return t&&(e+=t),e}(n),n=function(t){var e;let i="";for(;c.test(t);){let n=t.indexOf("![");i+=t.slice(0,n);let s=(t=t.slice(n+2)).indexOf("]("),r=t.slice(0,s);const l=r.match(/\((\d*x\d*)\)/),[c,o]=null!==(e=null==l?void 0:l[(null==l?void 0:l.length)-1].split("x"))&&void 0!==e?e:[];let a=(t=t.slice(s+2)).indexOf(")"),u=t.slice(0,a);t=t.slice(a+1),i+=c&&o?`<img alt="${r}" src=${u} style="width: ${c}px; height: ${o}px;" />`:`<img alt="${r}" src=${u} />`}return i+t}(n),n=function(t){let e="";for(;l.test(t);){let i=t.indexOf("[");e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("]("),s=t.slice(0,n),r=(t=t.slice(n+2)).indexOf(")"),l=t.slice(0,r);t=t.slice(r+1),e+=`<a target="_blank" href=${l}>${s}</a>`}return e+t}(n),n=function(t){return t.replace(/icon:(\w+)(\s|\b)/g,((t,e)=>`<i class='iconfont icon-${e}'></i>`))}(n),n=function(t){return t.replace(/svg:(\w+)(\s|\b)/g,((t,e)=>{const n=i.getSvg(e);return n||`<i class='iconfont icon-${e}'></i>`}))}(n),e?n:`<p>${n}</p>`}const s=/(#+)\s(.*)/g,r=/^\s*(\d+)\.\s(.+)/,l=/\[(.*)\]\((.*)\)/,c=/!\[(.*)\]\((.*)\)/;function o(t,e){let i=e?"<ol>":"<ul>";for(const e of t)i+=`<li>${n(e.content+a(e.children),!0)}</li>`;return i+=e?"</ol>":"</ul>",i}function a(t){let e="",i=0,n=t.length;if(0===n)return"";for(;i<n;){const s=[],r=[];for(;i<n&&"no_order"===t[i].type;)r.push(t[i]),i++;for(e+=o(r,!1);i<n&&"order"===t[i].type;)s.push(t[i]),i++;e+=o(s,!0)}return e.replace(/<ul><\/ul>/,"").replace(/<ol><\/ol>/,"")}function u(t){return r.test(t)}function f(t){let e=t.indexOf("- ");return 0==e||-1!=e&&!t.slice(0,e).trim()}function d(t){return"#"===t.trimStart()[0]}function h(t){return t.startsWith("```")}function g(t){return/^>/.test(t.trim())}function m(t){return"---"===t.trim()}function x(t){return"|"===t.trim()[0]}function p(t){return"::: start"===t.trim()||":::start"===t.trim()}function v(t){return":::"===t.trim()}function $(t){return"::: headStart"===t.trim()||":::headStart"===t.trim()}function b(t){return"::: mainStart"===t.trim()||":::mainStart"===t.trim()}function O(t){return`<blockquote>${t.slice(1)}</blockquote>`}function I(t,e,i,n){let s="",r=t[e].slice(3).trim().toLowerCase();for(++e;e<i&&!t[e].startsWith("```");)s+=t[e]+"\n",e++;t[e]="";const l=[n.highlight?`language-${r}`:"",n.lineNumber?"line-numbers":""].join(" ");return s=`<pre><code ${l&&`class='${l}'`}>${s}</code></pre>`,{startIdx:e,result:s}}function y(t){return t.length>6?6:t.length}function S(t){return t.trim().replace(s,((t,e,i)=>`<h${y(e)}>${n(i,!0)}</h${y(e)}>`))}function L(t,e,i){let s="<table>";for(s+=function(t){let e=-1,i="<thead><tr>";for(let s=0,r=t.length;s<r;s++)"|"==t[s]&&j(t,s-1)&&j(t,s+1)&&(-1!=e&&(i+=`<th>${n(t.slice(e+1,s))}</th>`),e=s);return i+"</tr></thead>"}(t[e]),s+="<tbody >",++e;e<i&&"|"===t[e].trim()[0];e++)s+=M(t[e]);return s+="</tbody></table>",s=s.replace(/<tr><\/tr>/,""),{startIdx:e-1,result:s}}function M(t){let e=-1,i="<tr>";for(let s=0,r=t.length;s<r;s++)if("|"==t[s]&&j(t,s-1)&&j(t,s+1)){if(-1!=e){let r=t.slice(e+1,s);if("-"===r.trim()[0])continue;i+=`<td>${n(r)}</td>`}e=s}return i+"</tr>"}function j(t,e){return" "===t[e]||null==t[e]}function w(t,e,i,n){let s="<div class=head-layout>",r="";for(++e;e<i&&("::: headEnd"!==(l=t[e]).trim()&&":::headEnd"!==l.trim());)t[e].trim()&&(r+=t[e]+"\n"),e++;var l;return s+=W(r,Object.assign(Object.assign({},n),{xss:!1}))+"</div>",{result:s,startIdx:e}}function k(t,e,i,n){let s="<div class=flex-layout>",r="";for(++e;e<i&&("::: end"!==(l=t[e]).trim()&&":::end"!==l.trim());){if(p(t[e])){const{result:s,startIdx:l}=k(t,e,i,n);r+=s,e=l}else if($(t[e])){const{result:s,startIdx:l}=w(t,e,i,n);r+=s,e=l}else v(t[e])?(s+=`<div class=flex-layout-item>${W(r,Object.assign(Object.assign({},n),{xss:!1}))}</div>`,r=""):r+=t[e].trim()?"\n"+t[e]+"\n":"";e++}var l;return s+=`<div class=flex-layout-item>${W(r,Object.assign(Object.assign({},n),{xss:!1}))}</div>`,s+="</div>",{result:s,startIdx:e}}function z(t,e,i,n){let s="<div class=main-layout>",r="";for(++e;e<i&&("::: mainEnd"!==(l=t[e]).trim()&&":::mainEnd"!==l.trim());)t[e].trim()&&(r+=t[e]+"\n"),e++;var l;return s+=W(r,Object.assign(Object.assign({},n),{xss:!1}))+"</div>",{result:s,startIdx:e}}function P(t,e,i){let n="";for(;e<i;e++)if(t[e].trim()){if(!u(t[e])&&!f(t[e]))break;n+=t[e]+"\n"}return n=function(t){const e=t.match(/(\s)*(-|\d+\.)\s(.+)/g);if(!e)return t;!function(t){/^\s+/.test(t[0])&&(t[0]=t[0].replace(/^(\s+)/g,(t=>"\n"))),t[0].startsWith("\n")||(t[0]="\n"+t[0])}(e);const i=function(t){const e=t,i=[],n=[];return e.forEach((t=>{if(""===t.trim())return;const e=t.length-t.trimLeft().length,s=t.trim();for(;n.length&&e<=n[n.length-1].indent;)n.pop();let r=null;/^-\s/.test(s)?r={type:"no_order",content:s.slice(2),children:[]}:/^(\d+\.)\s/.test(s)&&(r={type:"order",content:s.slice(RegExp.$1.length),children:[]}),r&&(n.length?n[n.length-1].item.children.push(r):i.push(r),n.push({indent:e,item:r}))})),i}(e);return a(i)}(n),{startIdx:e,result:n}}const E={lineNumber:!1,highlight:!1,xss:!0,svgMap:{}};function W(t,e){let s=e||E,r="";s=Object.assign(Object.assign({},E),s),s.svgMap&&i.setSvgMap(s.svgMap);let l=s.xss?(o=t,o.replace(/</g,"&lt;")).split("\n"):t.split("\n"),c=(null==l?void 0:l.length)||0;var o,a;for(let t=0;t<c;){if(d(l[t]))r+=S(l[t]);else if($(l[t])){const{result:e,startIdx:i}=w(l,t,c,s);t=i,r+=e}else if(b(l[t])){const{result:e,startIdx:i}=z(l,t,c,s);t=i,r+=e}else if(p(l[t])){const{result:e,startIdx:i}=k(l,t,c,s);t=i,r+=e}else if(m(l[t]))r+=3!==(a=l[t]).length?a:"---"===a?"<hr/>":a,++t;else if(x(l[t])){const{result:e,startIdx:i}=L(l,t,c);t=i,r+=e}else if(f(l[t])||u(l[t])){const{result:e,startIdx:i}=P(l,t,c);t=i-1,r+=e}else if(h(l[t])){const{result:e,startIdx:i}=I(l,t,c,s);t=i,r+=e}else g(l[t].trim())?r+=O(l[t].trim()):(l[t]=l[t].trim())&&(r+=n(l[t]));t++}return r}export{W as markdownToHTML,i as svgLoaderManager};
