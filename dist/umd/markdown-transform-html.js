!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MarkdownTransformer={})}(this,(function(t){"use strict";function e(t,e,i,n){return new(i||(i=Promise))((function(s,r){function l(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(l,o)}c((n=n.apply(t,e||[])).next())}))}class i{constructor(){this.svgMap={},this.isLoading=!1,this.isInitialized=!1,this.loader=null,this.initPromise=null,this.hasLoaderSet=!1}static getInstance(){return i.instance||(i.instance=new i),i.instance}setLoader(t){this.loader=t,this.hasLoaderSet=!0}setSvgMap(t){this.svgMap=t,this.isInitialized=!0,this.hasLoaderSet=!0}initialize(){return e(this,void 0,void 0,(function*(){return this.isLoading&&this.initPromise?this.initPromise:this.loader?(this.isLoading=!0,this.isInitialized=!1,this.initPromise=this.loader().then((t=>(this.svgMap=t,this.isInitialized=!0,this.isLoading=!1,this.svgMap))).catch((t=>(this.isLoading=!1,console.warn("SVG加载失败:",t),this.svgMap))),this.initPromise):(this.isInitialized=!0,this.svgMap)}))}getSvg(t){return this.svgMap[t]||null}isReady(){return this.isInitialized}reset(){this.svgMap={},this.isLoading=!1,this.isInitialized=!1,this.initPromise=null,this.hasLoaderSet=!1}}const n=i.getInstance();function s(t,e=!1){let i=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("**"));){e+=t.slice(0,i);let n=(t=t.slice(i+2)).indexOf("**");if(-1==n){t="**"+t;break}e+=`<strong>${t.slice(0,n)}</strong>`,t=t.slice(n+2)}return t&&(e+=t),e}(t);return i=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("*"));){e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("*");if(-1==n){t="*"+t;break}e+=`<i>${t.slice(0,n)}</i>`,t=t.slice(n+1)}return t&&(e+=t),e}(i),i=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("`"));){e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("`");if(-1==n){t="`"+t;break}e+=`<code class=single-code>${t.slice(0,n)}</code>`,t=t.slice(n+1)}return t&&(e+=t),e}(i),i=function(t){let e="",i=-1;for(;-1!=(i=t.indexOf("~~"));){e+=t.slice(0,i);let n=(t=t.slice(i+2)).indexOf("~~");if(-1==n){t="~~"+t;break}e+=`<del>${t.slice(0,n)}</del>`,t=t.slice(n+2)}return t&&(e+=t),e}(i),i=function(t){var e;let i="";for(;c.test(t);){let n=t.indexOf("![");i+=t.slice(0,n);let s=(t=t.slice(n+2)).indexOf("]("),r=t.slice(0,s);const l=r.match(/\((\d*x\d*)\)/),[o,c]=null!==(e=null==l?void 0:l[(null==l?void 0:l.length)-1].split("x"))&&void 0!==e?e:[];let a=(t=t.slice(s+2)).indexOf(")"),u=t.slice(0,a);t=t.slice(a+1),i+=o&&c?`<img alt="${r}" src=${u} style="width: ${o}px; height: ${c}px;" />`:`<img alt="${r}" src=${u} />`}return i+t}(i),i=function(t){let e="";for(;o.test(t);){let i=t.indexOf("[");e+=t.slice(0,i);let n=(t=t.slice(i+1)).indexOf("]("),s=t.slice(0,n),r=(t=t.slice(n+2)).indexOf(")"),l=t.slice(0,r);t=t.slice(r+1),e+=`<a target="_blank" href=${l}>${s}</a>`}return e+t}(i),i=function(t){return t.replace(/icon:(\w+)(\s|\b)/g,((t,e)=>`<i class='iconfont icon-${e}'></i>`))}(i),i=function(t){return t.replace(/svg:(\w+)(\s|\b)/g,((t,e)=>{const i=n.getSvg(e);return i||`<i class='iconfont icon-${e}'></i>`}))}(i),e?i:`<p>${i}</p>`}const r=/(#+)\s(.*)/g,l=/^\s*(\d+)\.\s(.+)/,o=/\[(.*)\]\((.*)\)/,c=/!\[(.*)\]\((.*)\)/;function a(t,e){let i=e?"<ol>":"<ul>";for(const e of t)i+=`<li>${s(e.content+u(e.children),!0)}</li>`;return i+=e?"</ol>":"</ul>",i}function u(t){let e="",i=0,n=t.length;if(0===n)return"";for(;i<n;){const s=[],r=[];for(;i<n&&"no_order"===t[i].type;)r.push(t[i]),i++;for(e+=a(r,!1);i<n&&"order"===t[i].type;)s.push(t[i]),i++;e+=a(s,!0)}return e.replace(/<ul><\/ul>/,"").replace(/<ol><\/ol>/,"")}function f(t){return l.test(t)}function d(t){let e=t.indexOf("- ");return 0==e||-1!=e&&!t.slice(0,e).trim()}function h(t){return"#"===t.trimStart()[0]}function g(t){return t.startsWith("```")}function m(t){return/^>/.test(t.trim())}function p(t){return"---"===t.trim()}function x(t){return"|"===t.trim()[0]}function v(t){return"::: start"===t.trim()||":::start"===t.trim()}function b(t){return":::"===t.trim()}function $(t){return"::: headStart"===t.trim()||":::headStart"===t.trim()}function O(t){return"::: mainStart"===t.trim()||":::mainStart"===t.trim()}function I(t){return`<blockquote>${t.slice(1)}</blockquote>`}function y(t,e,i,n){let s="",r=t[e].slice(3).trim().toLowerCase();for(++e;e<i&&!t[e].startsWith("```");)s+=t[e]+"\n",e++;t[e]="";const l=[n.highlight?`language-${r}`:"",n.lineNumber?"line-numbers":""].join(" ");return s=`<pre><code ${l&&`class='${l}'`}>${s}</code></pre>`,{startIdx:e,result:s}}function M(t){return t.length>6?6:t.length}function L(t){return t.trim().replace(r,((t,e,i)=>`<h${M(e)}>${s(i,!0)}</h${M(e)}>`))}function S(t,e,i){let n="<table>";for(n+=function(t){let e=-1,i="<thead><tr>";for(let n=0,r=t.length;n<r;n++)"|"==t[n]&&w(t,n-1)&&w(t,n+1)&&(-1!=e&&(i+=`<th>${s(t.slice(e+1,n))}</th>`),e=n);return i+"</tr></thead>"}(t[e]),n+="<tbody >",++e;e<i&&"|"===t[e].trim()[0];e++)n+=j(t[e]);return n+="</tbody></table>",n=n.replace(/<tr><\/tr>/,""),{startIdx:e-1,result:n}}function j(t){let e=-1,i="<tr>";for(let n=0,r=t.length;n<r;n++)if("|"==t[n]&&w(t,n-1)&&w(t,n+1)){if(-1!=e){let r=t.slice(e+1,n);if("-"===r.trim()[0])continue;i+=`<td>${s(r)}</td>`}e=n}return i+"</tr>"}function w(t,e){return" "===t[e]||null==t[e]}function k(t,e,i,n){let s="<div class=head-layout>",r="";for(++e;e<i&&("::: headEnd"!==(l=t[e]).trim()&&":::headEnd"!==l.trim());)t[e].trim()&&(r+=t[e]+"\n"),e++;var l;return s+=W(r,Object.assign(Object.assign({},n),{xss:!1}))+"</div>",{result:s,startIdx:e}}function z(t,e,i,n){let s="<div class=flex-layout>",r="";for(++e;e<i&&("::: end"!==(l=t[e]).trim()&&":::end"!==l.trim());){if(v(t[e])){const{result:s,startIdx:l}=z(t,e,i,n);r+=s,e=l}else if($(t[e])){const{result:s,startIdx:l}=k(t,e,i,n);r+=s,e=l}else b(t[e])?(s+=`<div class=flex-layout-item>${W(r,Object.assign(Object.assign({},n),{xss:!1}))}</div>`,r=""):r+=t[e].trim()?"\n"+t[e]+"\n":"";e++}var l;return s+=`<div class=flex-layout-item>${W(r,Object.assign(Object.assign({},n),{xss:!1}))}</div>`,s+="</div>",{result:s,startIdx:e}}function P(t,e,i,n){let s="<div class=main-layout>",r="";for(++e;e<i&&("::: mainEnd"!==(l=t[e]).trim()&&":::mainEnd"!==l.trim());)t[e].trim()&&(r+=t[e]+"\n"),e++;var l;return s+=W(r,Object.assign(Object.assign({},n),{xss:!1}))+"</div>",{result:s,startIdx:e}}function E(t,e,i){let n="";for(;e<i;e++)if(t[e].trim()){if(!f(t[e])&&!d(t[e]))break;n+=t[e]+"\n"}return n=function(t){const e=t.match(/(\s)*(-|\d+\.)\s(.+)/g);if(!e)return t;!function(t){/^\s+/.test(t[0])&&(t[0]=t[0].replace(/^(\s+)/g,(t=>"\n"))),t[0].startsWith("\n")||(t[0]="\n"+t[0])}(e);const i=function(t){const e=t,i=[],n=[];return e.forEach((t=>{if(""===t.trim())return;const e=t.length-t.trimLeft().length,s=t.trim();for(;n.length&&e<=n[n.length-1].indent;)n.pop();let r=null;/^-\s/.test(s)?r={type:"no_order",content:s.slice(2),children:[]}:/^(\d+\.)\s/.test(s)&&(r={type:"order",content:s.slice(RegExp.$1.length),children:[]}),r&&(n.length?n[n.length-1].item.children.push(r):i.push(r),n.push({indent:e,item:r}))})),i}(e);return u(i)}(n),{startIdx:e,result:n}}const T={lineNumber:!1,highlight:!1,xss:!0,svgMap:{}};function W(t,e){let i=e||T,r="";i=Object.assign(Object.assign({},T),i),i.svgMap&&n.setSvgMap(i.svgMap);let l=i.xss?(c=t,c.replace(/</g,"&lt;")).split("\n"):t.split("\n"),o=(null==l?void 0:l.length)||0;var c,a;for(let t=0;t<o;){if(h(l[t]))r+=L(l[t]);else if($(l[t])){const{result:e,startIdx:n}=k(l,t,o,i);t=n,r+=e}else if(O(l[t])){const{result:e,startIdx:n}=P(l,t,o,i);t=n,r+=e}else if(v(l[t])){const{result:e,startIdx:n}=z(l,t,o,i);t=n,r+=e}else if(p(l[t]))r+=3!==(a=l[t]).length?a:"---"===a?"<hr/>":a,++t;else if(x(l[t])){const{result:e,startIdx:i}=S(l,t,o);t=i,r+=e}else if(d(l[t])||f(l[t])){const{result:e,startIdx:i}=E(l,t,o);t=i-1,r+=e}else if(g(l[t])){const{result:e,startIdx:n}=y(l,t,o,i);t=n,r+=e}else m(l[t].trim())?r+=I(l[t].trim()):(l[t]=l[t].trim())&&(r+=s(l[t]));t++}return r}t.markdownToHTML=W,t.svgLoaderManager=n}));
